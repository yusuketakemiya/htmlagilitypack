[
  {
    "Id": "954090",
    "ThreadId": "406279",
    "Html": "\r\n<div id=\"_mcePaste\" style=\"overflow:hidden; height:1px; left:-10000px; top:0px; width:1px\">\r\n&#65279;</div>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><div style=\"color:black; background-color:white\"><pre><span style=\"color:blue\">var</span> sb = <span style=\"color:blue\">new</span> StringBuilder(<span style=\"color:#a31515\">&quot;&lt;html&gt;\\r\\t&lt;body&gt;\\r\\t\\t&lt;select&gt;\\r&quot;</span>);\r\nsb.AppendLine(<span style=\"color:#a31515\">&quot;\\t\\t\\t&lt;option value =\\&quot;foobar\\&quot; selected=\\&quot;selected\\&quot;&gt;FooBar&lt;/option&gt;&quot;</span>);\r\nsb.AppendLine(<span style=\"color:#a31515\">&quot;\\t\\t\\t&lt;option value =\\&quot;foo\\&quot;&gt;foo&lt;/option&gt;&quot;</span>);\r\nsb.AppendLine(<span style=\"color:#a31515\">&quot;\\t\\t\\t&lt;option value =\\&quot;bar\\&quot;&gt;bar&lt;/option&gt;&quot;</span>);\r\nsb.AppendLine(<span style=\"color:#a31515\">&quot;\\t\\t&lt;/select&gt;\\r\\t&lt;/body&gt;\\r&lt;/html&gt;&quot;</span>);\r\n<span style=\"color:blue\">var</span> htmlDoc = <span style=\"color:blue\">new</span> HtmlDocument();\r\nhtmlDoc.LoadHtml(sb.ToString());\r\n<span style=\"color:blue\">var</span> sb2 = <span style=\"color:blue\">new</span> StringBuilder();\r\n<span style=\"color:blue\">var</span> sw = <span style=\"color:blue\">new</span> StringWriter(sb2);\r\nhtmlDoc.Save(sw);\r\nAssert.AreEqual(sb.ToString(), sb2.ToString());\r\n</pre>\r\n<pre>here is the input:</pre>\r\n<pre><div style=\"color:black; background-color:white\"><pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">html</span><span style=\"color:blue\">&gt;</span>\r\n\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">body</span><span style=\"color:blue\">&gt;</span>\r\n\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">select</span><span style=\"color:blue\">&gt;</span>\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span> <span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;foobar&quot;</span> <span style=\"color:red\">selected</span><span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;selected&quot;</span><span style=\"color:blue\">&gt;</span>FooBar<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">option</span><span style=\"color:blue\">&gt;</span>\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span> <span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;foo&quot;</span><span style=\"color:blue\">&gt;</span>foo<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">option</span><span style=\"color:blue\">&gt;</span>\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span> <span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;bar&quot;</span><span style=\"color:blue\">&gt;</span>bar<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">option</span><span style=\"color:blue\">&gt;</span>\r\n\t\t<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">select</span><span style=\"color:blue\">&gt;</span>\r\n\t<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">body</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">html</span><span style=\"color:blue\">&gt;</span>\r\n\r\n</pre>\r\n</div>\r\nthis is the output:</pre>\r\n<pre><div style=\"color:black; background-color:white\"><pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">html</span><span style=\"color:blue\">&gt;</span>\r\n\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">body</span><span style=\"color:blue\">&gt;</span>\r\n\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">select</span><span style=\"color:blue\">&gt;</span>\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span><span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;foobar&quot;</span> <span style=\"color:red\">selected</span><span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;selected&quot;</span><span style=\"color:blue\">&gt;</span>FooBar\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span><span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;foo&quot;</span><span style=\"color:blue\">&gt;</span>foo\r\n\t\t\t<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">option</span> <span style=\"color:red\">value</span><span style=\"color:blue\">=</span><span style=\"color:blue\">&quot;bar&quot;</span><span style=\"color:blue\">&gt;</span>bar\r\n\t\t<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">select</span><span style=\"color:blue\">&gt;</span>\r\n\t<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">body</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">html</span><span style=\"color:blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n</pre>\r\n</div>\r\n</pre>\r\n</div>\r\n",
    "PostedDate": "2012-12-10T10:07:40.847-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "985913",
    "ThreadId": "406279",
    "Html": "\r\n<p>Blair,</p>\r\n<p>I was running into problem myself. My solution was to add these lines before and after I load the HTML into the document (which is when HtmlAgilityPack actual parses the tree):</p>\r\n<p>&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">// HtmlNode.ElementFlags is an app-wide public static (singleton, essentially)</span>\r\n<span style=\"color:green\">// This tell's HtmlAgilityPack to remove the &quot;option&quot; tag's flags.</span>\r\n<span style=\"color:green\">// The flag we are removing is &quot;HtmlElementFlag.Closed&quot;.</span>\r\nHtmlElementFlag oldFlags = HtmlNode.ElementsFlags[<span style=\"color:#a31515\">&quot;option&quot;</span>];\r\nHtmlNode.ElementsFlags.Remove(<span style=\"color:#a31515\">&quot;option&quot;</span>);\r\n\r\ndocument.LoadHtml(htmlString);\r\n<span style=\"color:green\">// Or, document.Load(htmlStream);</span>\r\n\r\n<span style=\"color:green\">// This part is not necessary, I just like cleaning up after myself.</span>\r\nHtmlNode.ElementsFlags[<span style=\"color:#a31515\">&quot;option&quot;</span>] = oldFlags;\r\n</pre>\r\n</div>\r\nHope this works out for you!\r\n<p></p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2013-01-12T08:57:16.337-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]