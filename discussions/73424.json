[
  {
    "Id": "250935",
    "ThreadId": "73424",
    "Html": "<p>A little background to my problem.</p>\r\n<p>I am attempting to create a dynamic CMS system using custom tags within a html document. These tags are parsed by HAP and I then insert the information in the tags into the database for later use. This process works fine, the problem occurs when I attempt to manipulate the html at a later stage.</p>\r\n<p>One of the tags I am using is a &lt;list&gt;. Please dont slate me for doing it this way, I needed a quick solution to demostrate something to a potential client and decided this was a good way. Anyway, the HTML will have sections like this;</p>\r\n<p>&nbsp;&lt;list name=&quot;sidenav&quot; description=&quot;Side Navigation&quot;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;field type=&quot;image&quot; name=&quot;sidenav_header&quot; description=&quot; Header Image with Link&quot; link=&quot;true&quot;&gt;&lt;/field&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table &gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td &gt;&lt;field type=&quot;image&quot; name=&quot;sidenav_content_image&quot; description=&quot;Content Image&quot; groupname=&quot;sidenav&quot; link=&quot;false&quot;&gt;&lt;/field&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;field type=&quot;field&quot; name=&quot;sidenav_content&quot; description=&quot;Content with Link&quot; link=&quot;true&quot;&gt;&lt;/field&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/p&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/list&gt;</p>\r\n<p>Which is then in the database. The user would then come along and add 'list' items, these are made up on the admin screen on the &lt;field&gt;'s found in the &lt;list&gt;. Again the B side works fine.</p>\r\n<p>Now the process needs to take these list entries and insert them into the content that was previously saved. This process is as follows;</p>\r\n<p>For each list, build the content from the DB. (works fine and produces standard html)<br>Find the &lt;list&gt; tag in the doc and change the innerhtml&nbsp; of the node to the generated content.<br>Get the parent node.<br>Removenode using parent.removenode(child, true)<br><br>Now this is where my problems start. It removes the node, but the contents that were generated become mixed up. The generated content looks like this;</p>\r\n<p><span>&lt;h3&gt; &lt;img src=&quot;/file.aspx?id=3477&quot;&gt; &lt;/h3&gt;<br>&lt;table&gt;<br>&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;img src=&quot;/file.aspx?id=3478&quot;&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt; fsafaf &lt;/p&gt;&lt;/td&gt;<br>&nbsp; &lt;/tr&gt;<br>&lt;/table&gt;</span></p>\r\n<p><span>Which is you can see, matched the layout defined in the &lt;list&gt; above. However, after calling RemoveNode, it looks like this;</span></p>\r\n<p><span>\r\n<p><br>&lt;table&gt;<br>&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;img src=&quot;/file.aspx?id=3478&quot;&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt; fsafaf &lt;/p&gt;&lt;/td&gt;<br>&nbsp; &lt;/tr&gt;<br>&lt;/table&gt;<br><span>&lt;h3&gt; &lt;img src=&quot;/file.aspx?id=3477&quot;&gt; &lt;/h3&gt;<br><br>Is this something that can be explained.<br><br>My second problem was encountered by findiing my own solution to the first.<br><br>The process went like this;<br><br>For each list, build the content from the DB. (works fine and produces standard html)<br>Find the &lt;list&gt; tag in the doc and change the innerhtml&nbsp;to &quot;&quot;<br>Get the parent node.<br>Removenode using parent.removenode(child, true)<br>Insert generated content at n.OuterStartIndex.<br><br>Now, I have not looked at the HAP code in huge detail, but would have assumed that this would give me the startposition of &lt;list&gt; in the doc. </span></p>\r\n</span>\r\n<p><span></span>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n</p>\r\n<p>&nbsp;</p>\r\n</p>\r\n<p><span>So the doc would look something like this;</span></p>\r\n<p><span>\r\n<p><br>&lt;table&gt;&lt;tr&gt;&lt;td&gt;<br>&lt;list name=&quot;sidenav&quot; description=&quot;Side Navigation&quot;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;field type=&quot;image&quot; name=&quot;sidenav_header&quot; description=&quot; Header Image with Link&quot; link=&quot;true&quot;&gt;&lt;/field&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table &gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td &gt;&lt;field type=&quot;image&quot; name=&quot;sidenav_content_image&quot; description=&quot;Content Image&quot; groupname=&quot;sidenav&quot; link=&quot;false&quot;&gt;&lt;/field&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;field type=&quot;field&quot; name=&quot;sidenav_content&quot; description=&quot;Content with Link&quot; link=&quot;true&quot;&gt;&lt;/field&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/p&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/list&gt;<br>&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</p>\r\n<p>Based on this, I would assume (and can see from debug)&nbsp;that getting the list node, and setting the innerhtml to &quot;&quot;&nbsp;would leave me with this;</p>\r\n</span>&lt;table&gt;&lt;tr&gt;&lt;td&gt;<br>&nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;<br><br>Using the supposed outerstartindex, insert the generated HTML and I would expect this;</p>\r\n<p><br>&lt;table&gt;&lt;tr&gt;&lt;td&gt;<br>&lt;list name=&quot;sidenav&quot; description=&quot;Side Navigation&quot;&gt;<br>&lt;/list&gt;<br>&nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;<br><br>Note that I have checked node.outerstartindex before and after this and they are the same.<br><br>Now remove the child using the parent;</p>\r\n<p>&nbsp;</p>\r\n<p>&lt;table width=\\&quot;192\\&quot; border=\\&quot;0\\&quot; cellspacing=\\&quot;0\\&quot; cellpadding=\\&quot;0\\&quot; class=\\&quot;sidebar\\&quot;&gt;<br>&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h3&gt; &lt;img src=\\&quot;/file.aspx?id=3477\\&quot;&gt; &lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;img src=\\&quot;/file.aspx?id=3478\\&quot;&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt; fsafaf &lt;/p&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/td&gt; <br>&nbsp; &lt;/tr&gt;<br>&lt;/table&gt;</p>\r\n<p>Yet, I get this;</p>\r\n<p>&lt;table width=\\&quot;192\\&quot; border=\\&quot;0\\&quot; cellspacing=\\&quot;0\\&quot; cellpadding=\\&quot;0\\&quot; class=\\&quot;sidebar\\&quot;&gt;<br>&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;h3&gt; &lt;img src=\\&quot;/file.aspx?id=3477\\&quot;&gt; &lt;/h3&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;img src=\\&quot;/file.aspx?id=3478\\&quot;&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;p&gt; fsafaf &lt;/p&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; td&gt; <br>&nbsp; &lt;/tr&gt;<br>&lt;/table&gt;<br><br>Which appeared to me at this point to be 2 chars out. To confirm this, I added this code jsut before;</p>\r\n<p>int pos = string.IndexOf(&quot;&lt;list&quot;);</p>\r\n<p>and yes, it was 2 chars difference (3345 from HAP, 3343 from IndexOf.<br><br>SO i changed my code to check myself where the pos was and it all works fine now, but is this a bug somewhere or am I mistunderstanding it.<br><br>Apologies for the long post.</p>\r\n<p>Thanks<br><br></p>\r\n<p>\r\n<p><span style=\"font-size:xx-small\">&lt;font size=&quot;1&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span>\r\n<p>&nbsp;</p>\r\n</p>\r\n</p>",
    "PostedDate": "2009-10-28T16:47:56.32-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]