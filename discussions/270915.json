[
  {
    "Id": "665414",
    "ThreadId": "270915",
    "Html": "\r\n<p>Hi, &nbsp;eveyrone.</p>\r\n<p>&nbsp;</p>\r\n<p>I am working on a HTML Email merge project. Idea is very simple. &nbsp;Create HTML email template, call some variable from sql server and insert variables into html email template.</p>\r\n<p>Problem I am having is replacing special variable like '@LastName' in HTML email template with actual last name value from database. &nbsp;I am not sure if HTMLAgilityPack can replace pre-specifed&nbsp;charters&nbsp;with data or not... if so how would do\r\n this?? I am a system admin with minimal programming background... and so far I wrote follwoing code:</p>\r\n<p>&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">using</span> System;\r\n<span style=\"color:blue\">using</span> System.Collections.Generic;\r\n<span style=\"color:blue\">using</span> System.ComponentModel;\r\n<span style=\"color:blue\">using</span> System.Data;\r\n<span style=\"color:blue\">using</span> System.Drawing;\r\n<span style=\"color:blue\">using</span> System.Linq;\r\n<span style=\"color:blue\">using</span> System.Text;\r\n<span style=\"color:blue\">using</span> System.Windows.Forms;\r\n<span style=\"color:blue\">using</span> System.Net.Mail;\r\n<span style=\"color:blue\">using</span> System.Data.SqlClient;\r\n\r\n\r\n<span style=\"color:blue\">namespace</span> Email_Application\r\n{\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">partial</span> <span style=\"color:blue\">class</span> Form1 : Form\r\n    {\r\n        \r\n        SqlDataReader SQLResult = <span style=\"color:blue\">null</span>;\r\n        SqlCommand SQLCommand;\r\n        SqlConnection SQLConnection;\r\n        SqlParameter TemplateName;\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> TemplateNameValue =  <span style=\"color:#a31515\">&quot;Test&quot;</span>;\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> BranchEmail = <span style=\"color:#a31515\">&quot;test@test.com&quot;</span>;\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">string</span> ToAddress = <span style=\"color:#a31515\">&quot;test2@test2.com&quot;</span>;\r\n    \r\n     \r\n\r\n        \r\n        <span style=\"color:blue\">public</span> Form1()\r\n        {\r\n            InitializeComponent();\r\n        }\r\n\r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> SQL()\r\n        {\r\n\r\n            TemplateName = <span style=\"color:blue\">new</span> SqlParameter(<span style=\"color:#a31515\">&quot;@TemplateName&quot;</span>, SqlDbType.VarChar, 256);\r\n            TemplateName.Value = TemplateNameValue;\r\n            SQLConnection = <span style=\"color:blue\">new</span> SqlConnection(<span style=\"color:#a31515\">&quot;server=local; database=EmailTemplate; User ID = SQLAccess; Password = SQLTEST&quot;</span>);\r\n            SQLConnection.Open();\r\n            SQLCommand = <span style=\"color:blue\">new</span> SqlCommand(<span style=\"color:#a31515\">&quot;select * from EmailTemplate where TemplateName = @TemplateName&quot;</span>, SQLConnection);\r\n            SQLCommand.Parameters.Add(TemplateName);\r\n            SQLResult = SQLCommand.ExecuteReader();\r\n            SQLResult.Read();\r\n\r\n\r\n        }\r\n        \r\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> Email()\r\n        {\r\n            <span style=\"color:blue\">string</span> FromAddress = <span style=\"color:#a31515\">&quot;test@test.com&quot;</span>;\r\n            <span style=\"color:blue\">string</span> EmailContent = SQLResult[<span style=\"color:#a31515\">&quot;EmailBody&quot;</span>].ToString();\r\n            <span style=\"color:blue\">string</span> NewEmailContent = EmailContent.Replace(<span style=\"color:#a31515\">&quot;@BranchEmail&quot;</span>, BranchEmail).Replace(<span style=\"color:#a31515\">&quot;@Email&quot;</span>,ToAddress);\r\n             \r\n            \r\n            <span style=\"color:green\">//create the mail message</span>\r\n            MailMessage mail = <span style=\"color:blue\">new</span> MailMessage();\r\n\r\n            <span style=\"color:green\">//set the addressesbhan c</span>\r\n            mail.From = <span style=\"color:blue\">new</span> MailAddress(FromAddress);\r\n            mail.To.Add(ToAddress);\r\n\r\n            <span style=\"color:green\">//set the content</span>\r\n            mail.Subject = SQLResult[<span style=\"color:#a31515\">&quot;EmailTitle&quot;</span>].ToString();\r\n            mail.Body = NewEmailContent;\r\n            mail.IsBodyHtml = <span style=\"color:blue\">true</span>;\r\n\r\n            <span style=\"color:green\">//send the message</span>\r\n            SmtpClient smtp = <span style=\"color:blue\">new</span> SmtpClient(<span style=\"color:#a31515\">&quot;laexchb.la.cryobank.com&quot;</span>);\r\n            smtp.Send(mail);\r\n        }\r\n\r\n        \r\n\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> button1_Click(<span style=\"color:blue\">object</span> sender, EventArgs e)\r\n        {\r\n            SQL();\r\n            Email();\r\n            <span style=\"color:blue\">string</span> EmailBody = SQLResult[<span style=\"color:#a31515\">&quot;EmailBody&quot;</span>].ToString();\r\n            <span style=\"color:blue\">string</span> NewBody = EmailBody.Replace(<span style=\"color:#a31515\">&quot;@BranchEmail&quot;</span>, BranchEmail);\r\n\r\n            MessageBox.Show(NewBody);\r\n            SQLConnection.Close();\r\n\r\n        }\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>So due to my limited C# programming skill, I am basically calling html code from sql server. &nbsp;Ideally I want to save html email on our sharepoint (so user can create/edit html email with word), call template html email file, convert html email to string.</p>\r\n<p>once html is converted to string, replace special word with database value and send html email to our client. &nbsp;I know this is not the best, but with my 7 days of c# programming study, this was the best solution I came up with...</p>\r\n<p>&nbsp;</p>\r\n<p>If you have any suggestion or help would be appricated!</p>\r\n<p>&nbsp;</p>\r\n<p>Thank you!</p>\r\n",
    "PostedDate": "2011-08-30T11:04:20.32-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]